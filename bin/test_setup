#!/bin/bash

set -ex

if ! dpkg -s python-virtualenv ; then
    sudo apt-get install -y python-virtualenv
fi

if ! dpkg -s python-dev ; then
    sudo apt-get install -y python-dev
fi

if [ ! -d .venv ]; then
    virtualenv -p /usr/bin/python2.7 .venv
    . .venv/bin/activate
    pip install -r requirements.txt \
      --allow-external lazr.authentication \
      --allow-unverified lazr.authentication
    python setup.py develop
fi

